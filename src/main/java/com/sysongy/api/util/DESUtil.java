package com.sysongy.api.util;

import java.security.InvalidAlgorithmParameterException;
import java.security.Key;
import java.security.spec.AlgorithmParameterSpec;
import java.util.Locale;

import javax.crypto.Cipher;
import javax.crypto.SecretKeyFactory;
import javax.crypto.spec.DESKeySpec;
import javax.crypto.spec.IvParameterSpec;

/**
 * @FileName: DESUtil
 * @Encoding: UTF-8
 * @Package: com.sysongy.api.util
 * @Link: http://www.sysongy.com
 * @Created on: 2016年08月16日, 10:57
 * @Author: dongqiang.wang [wdq_2012@126.com]
 * @Version: V2.0 Copyright(c)陕西司集能源科技有限公司
 * @Description: DES加密解密工具包
 */
public class DESUtil {
    public static final String ALGORITHM_DES = "DES/CBC/PKCS5Padding";

    /**
     * DES算法，加密
     *
     * @param data
     *            待加密字符串
     * @param key
     *            加密私钥，长度不能够小于8位
     * @return 加密后的字节数组，一般结合Base64编码使用
     * @throws InvalidAlgorithmParameterException
     * @throws Exception
     */
    public static String encode(String key, String data) {
        if (data == null)
            return null;
        try {
            DESKeySpec dks = new DESKeySpec(key.getBytes("UTF-8"));
            SecretKeyFactory keyFactory = SecretKeyFactory.getInstance("DES");
            // key的长度不能够小于8位字节
            Key secretKey = keyFactory.generateSecret(dks);
            Cipher cipher = Cipher.getInstance(ALGORITHM_DES);
            IvParameterSpec iv = new IvParameterSpec("12345678".getBytes());
            AlgorithmParameterSpec paramSpec = iv;
            cipher.init(Cipher.ENCRYPT_MODE, secretKey, paramSpec);
            byte[] bytes = cipher.doFinal(data.getBytes("UTF-8"));
            /*return new String(bytes,"UTF-8");*/
            return byte2String(bytes);
        } catch (Exception e) {
            e.printStackTrace();
            return data;
        }
    }

    /**
     * DES算法，解密
     *
     * @param data
     *            待解密字符串
     * @param key
     *            解密私钥，长度不能够小于8位
     * @return 解密后的字节数组
     * @throws Exception
     *             异常
     */
    public static String decode(String key, String data) {
        if (data == null)
            return null;
        try {
            DESKeySpec dks = new DESKeySpec(key.getBytes("UTF-8"));
            SecretKeyFactory keyFactory = SecretKeyFactory.getInstance("DES");
            // key的长度不能够小于8位字节
            Key secretKey = keyFactory.generateSecret(dks);
            Cipher cipher = Cipher.getInstance(ALGORITHM_DES);
            IvParameterSpec iv = new IvParameterSpec("12345678".getBytes());
            AlgorithmParameterSpec paramSpec = iv;
            cipher.init(Cipher.DECRYPT_MODE, secretKey, paramSpec);
            return new String(cipher.doFinal(byte2hex(data.getBytes("UTF-8"))),"UTF-8");
        } catch (Exception e) {
            e.printStackTrace();
            return data;
        }
    }

    /**
     * 二行制转字符串
     *
     * @param b
     * @return
     */
    private static String byte2String(byte[] b) {
        StringBuilder hs = new StringBuilder();
        String stmp;
        for (int n = 0; b != null && n < b.length; n++) {
            stmp = Integer.toHexString(b[n] & 0XFF);
            if (stmp.length() == 1)
                hs.append('0');
            hs.append(stmp);
        }
        return hs.toString().toUpperCase(Locale.CHINA);
    }

    /**
     * 二进制转化成16进制
     *
     * @param b
     * @return
     */
    private static byte[] byte2hex(byte[] b) {
        if ((b.length % 2) != 0)
            throw new IllegalArgumentException();
        byte[] b2 = new byte[b.length / 2];
        for (int n = 0; n < b.length; n += 2) {
            String item = new String(b, n, 2);
            b2[n / 2] = (byte) Integer.parseInt(item, 16);
        }
        return b2;
    }

    public static void main(String args[]) throws Exception{
//        String str = "王冬强";
        String str = "{\"main\":{},\"extend\": {\"version\": \"1.0\",\"terminal\": \"1\"}}";
        String keyStr = "sysongys";
        System.out.println("加密后:"+encode(keyStr,str));
        String resultStr;
        resultStr = decode(keyStr,"245CCF75CF962711DCC38E5572797E4A2F2689F73BBCD5C572943C97F813F01F74A76EEC323565116D9EF9AE44EEC58B841D386BEFD0A7DE26F9D190602935789A237E44621D6B035C48AA2F10609B20559E7E82EFA6BDC3B5929C30E950CDA695988C0E34B089D2DC533D38BE897F200E54EA5AD2BEFEA103F193A1259A9B8210FAE63C288F8DBFDB8BE0A57206F5840409CB060497B76B2E78B24A599DF9F265383F9A131AA9FAABCD10DDE7E64D8F3378801FCBBF380E728757D9DAE2D989DC6D5F107EF9301242DC19EC07923CD2EFCAF509B16F11AF1E93B5224EC95C7041E1982611F45B3D708F6603C3D4C7545ADD5B2BA0EECC4EDB5BBD7F944B40B438ADB95693D98A931394784923DE000354716798E433675492869BFDE953E92A9E751ABDD07DD5CB2F37D5901A1325888719F023EF87F6B9815DE0E09282CB3A39D1F5C3835DFF4D35569ED231B9DBA46D87EDA2C6D3B75E8A38901811A48AE36A3BB30676FEA21DA54EE17FC2CBB715E78827CFBDC40FB762B8DC2ECB87506D11B22800836B4EF8972107E2022F5E4A493E6CAB592A36B2AFB886CD45FD9226E979B5CFB9B1CE748E077102508FFCF0258C25590BECB979B04E4131366DC00B702C0D127E09B0E8BF59474D47441C73779A9F887A483FD7C557359532615ED25F6BB49ED639B4AE21D89237A68CCECDEABA16331B04CB6E3EC6B41BE19B1CA461ED1A183DF1147A07DA226BE5CCA93B55593F209E22BB770A641E3EE9C1DBE06266620C62D988E20B2C372F33063F7C2E5348989456566ABBDA1AAEDE63027F8ACB9D5D0B4FEC580EF529AB0EBD905480DF08FC26203A593C1974D782F9D0D9470F51A838761CFE1CA651FEA512D7037443B41480B5ACA4C6D10D4E51F6FD8370A079DC5C819A187AB0624E7772175B2563AA5A83D5B711DBD79315CC0EBB9F676A6C18F15DEDFABBB09BA29AEF98411C35EAD7B24C742AC5E0CC7E71979BC243FA38C4F1E18BE2B96C11395F1E17BAB1C79A86739EAE0DE041B1F2D9B3CB5A44B173887539AADD8451380729C8B2278703EF74012D332F445BA3FADE8945D44DCD60B31B7B74EFCC774FE7A3F6DE6BF8B47FE1CCF89E7C495E982EDD24385E1D34B724C3E884E202CCD4BA86897F4F4DC60656CAF11D53A3D282DE4A5EDD2B3D3587C64D2BAF8F8B17928F3739A02D6B5FE9BCA28E3EF9FE5DBC742E6CCD3A9D7FFAE553E8E03926BA7EB8937C63A13B9B86FBB398FB3E35DC7A51B0FFE0D08C5C8C9C91C598412851A02A8D8051FCC39B8172EAB9AA1A5C5A2F9BEA5084CD7A166B2CA196617AB221E7367C05F6CB5D172D1D4C3CE4851DA691A715AED61F6866FFA6D6C2F51D7D38E4FC70E23EAE97DCCD8065DD8D515D88D76F382FE0B8CB3A1058EDA732F023835B68EE4B458FAADC26A3DEA49AFA14480BC05278573A44DCC4E1D62195D539C6D64E2B7F5E9CC70E83A45A06DDA58C6906A7E5E4358D846407067BF5EC61D1B0A3EDA288F249D1A2952F03AAB9FC65B69B78F42D1BC889896358215CD039F845024A0C0328A2B17BB97C032D28BBB25EC61973489041A5287EF7C792E6BD083271C48D36D1A4624D2B07429D88C2C8E1AA46C4FA38B5FB6C3CB13495D2214F3D97B0BD86B49B01CD0F563211B537B17C4A8F381B5C347043F6BF4F68C98F4E1DC2FF5C7DB4A60A4F166865625B8EB50BD5552DD6D1BAEBFC6C12139FDD981A8470727F4E3C8DA5E28DC60C49ABAB24B5043E499F0B4A33C7610133966CBD3D2A2FE91A8DF30D7002458A33D678C3B33C6CC785BD71D9B5A72CF0F4D72FAE399D7971CBF159728FE29C4CFCBDE8E939FECB4AA472F68A651A96B2655DFF7FC413E78395B97266537EC77C2B68BE6E37523D41F13E4CF8A4602E967A1580FDFF7655882FEE69722C3B374ACE2DA0B816CF2991F5A310CC2E6735B6B1903B21E437F40075B90577A8948D55412BCE9064D9F0FDB40EC23A4CD377BADEDD4C2E5C2296B2DD3DBA832FEBB9426A7601764AE6D646DDD4E2BE359E56A37203A601782C280887EC063480FADCBC4F98CB0E8436C7DC9ACF92B96D8C0427AF20C5E51DC84DCDB8E9599BA90A4D2793E9EEB4DD384C72E4FECDECE06C71A1FDC4F6254557F222C32E211D130D9F97D49A1A8EC73696AADE8777172B2FF8E62544129B0BC485509645833CA939056BFED0065CB46562424EFB5F6B5AB0CD147420A47B7B481EEEBB053B0BD0A2C5C9D5793D3D1D9EAC6599D183BC89DDFB8B160F550E61DBE18A530C00C37175EB4CA784596DCC626AA7A3BA745B4A7654B63472DB8DC0F04C85E061D4F07205665A8DFA997B17A30942F49CBC075E9674E9AD6E3D68B0A02F0152D457F79A3F323C3EACC7406B9B5B52688F4545602E694EEC3269FB6FCDCDC9F3954396084ECC9E2F9C9515623230854912AD14E9A2BF314EF20DE40779BF1753C3688B475E8712C6A1456574846A0FCFE615E7A5D3C0626E98E109BBA837390353B98BAD0F2EC19D092CE7A7AF63EAB1371B0BE332103AB4D9A581424BFF0031AD06C55CCE5EAFD515E0CC9470BC7A05BA0B596143AD2148B0F09324C20C09C0EB9E4707C17F49459F4CB26C8719F1BACE831704EC18811FAADEBF65A50A6AC880B96D2CB0D0AD1FCBBD8F53039BA73F58A616EA51E1F3976FFFE8CF0F23D10F77F4E503784D826D1A1C54F87EFA2EFC47505618C1E9C7EBEDBF71FEC376E43C8016933A32247C02A6666692C640DB0F8BDCB80A5EB7B48D5C4CC21E2174DD79527AAB0502476A5564A74D4B05B5");
//        resultStr = new String(resultStr.getBytes("GB2312"),"ISO-8859-1");
        System.out.println("解密后:"+resultStr);
    }
}
